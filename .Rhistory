# Load required libraries ####
pacman::p_load(podcleaner, here, parallel, readr)
# Define globals ####
path_data <- "C:/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-entrepreneurs/analysis/extract-load-transform/data"
progress <- TRUE; verbose <- FALSE
## Define locals ####
directories <- c("1861-1862")
## General directories ####
path_directories <- utils_make_path(path_data, "general-directories")
general_directory_raw <- utils_load_directories_csv(
"general", directories, path_directories, verbose
)
# Define globals ####
path_data <- "C:/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-pod-cleaner/data"
## General directories ####
path_directories <- utils_make_path(path_data, "general-directories")
general_directory_raw <- utils_load_directories_csv(
"general", directories, path_directories, verbose
)
# Define globals ####
# path_data <- "C:/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-pod-cleaner/data"
path_data <- "mnt/c/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-pod-cleaner/data"
progress <- TRUE; verbose <- FALSE
## Define locals ####
directories <- c("1861-1862")
## General directories ####
path_directories <- utils_make_path(path_data, "general-directories")
general_directory_raw <- utils_load_directories_csv(
"general", directories, path_directories, verbose
)
# Define globals ####
# path_data <- "C:/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-pod-cleaner/data"
path_data <- "/mnt/c/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-pod-cleaner/data"
progress <- TRUE; verbose <- FALSE
## Define locals ####
directories <- c("1861-1862")
## General directories ####
path_directories <- utils_make_path(path_data, "general-directories")
general_directory_raw <- utils_load_directories_csv(
"general", directories, path_directories, verbose
)
# Define globals ####
# path_data <- "C:/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-pod-cleaner/data"
path_data <- "/mnt/c/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-clean-pod/data"
progress <- TRUE; verbose <- FALSE
## Define locals ####
directories <- c("1861-1862")
## General directories ####
path_directories <- utils_make_path(path_data, "general-directories")
general_directory_raw <- utils_load_directories_csv(
"general", directories, path_directories, verbose
)
## trades directories ####
path_directories <- utils_make_path(path_data, "trades-directories")
trades_directory_raw <- utils_load_directories_csv(
"trades", directories, path_directories, verbose
)
# Clean ####
general_directory_clean <-
general_clean_directory(general_directory_raw, progress, verbose)
trades_directory_clean <-
trades_clean_directory(trades_directory_raw, progress, verbose)
## locals ####
# trades_directory <- dplyr::slice(trades_directory_clean, 1:999L)
trades_directory <- trades_directory_clean
general_directory <- general_directory_clean
nthread <- detectCores(all.tests = FALSE, logical = TRUE) - 1L
progress <- TRUE; verbose <- FALSE
combined <- combine_match_general_to_trades(
trades_directory, general_directory, progress, verbose,
method = "osa", max_dist = 5L, nthread = nthread
)
combined
View(combined)
path_output <- "/mnt/c/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-clean-pod/output"
file_name <- "post-office-directory-osa"
## rds ####
readr::write_rds(combined, paste0(path_output, "/", file_name, ".rds"))
readr::write_csv(combined, paste0(path_output, "/", file_name, ".csv"))
devtools::load_all(".")
directory <- tibble::tibble(
page = rep("71", 3L),
surname = c("ABOT", "ABRCROMBIE", "BLAI"), forename = c("Wm.", "Alex", "Jn Huh"),
occupation = c(
"Wine and spirit merchant; house", "Baker", "Victualer"
),
addresses = c("1820 Mary hill", "", "280, High stret")
)
directory
regex <- globals_regex_house_to_address
general_move_house_to_address(directory, regex)
directory <- tibble::tibble(
page = rep("71", 3L),
surname = c("ABOT", "ABRCROMBIE", "BLAI"), forename = c("Wm.", "Alex", "Jn Huh"),
occupation = c(
"Wine and spirit merchant; house", "Baker", "Victualer"
),
addresses = c("1820 Mary hill", "", "280, High stret")
)
regex <- globals_regex_house_to_address
devtools::load_all(".")
directory <- tibble::tibble(
page = rep("71", 3L),
surname = c("ABOT", "ABRCROMBIE", "BLAI"), forename = c("Wm.", "Alex", "Jn Huh"),
occupation = c(
"Wine and spirit merchant; house", "Baker", "Victualer"
),
addresses = c("1820 Mary hill", "", "280, High stret")
)
regex <- globals_regex_house_to_address
general_move_house_to_address(directory, regex)
devtools::load_all(".")
directory <- tibble::tibble(
page = rep("71", 3L),
surname = c("ABOT", "ABRCROMBIE", "BLAI"), forename = c("Wm.", "Alex", "Jn Huh"),
occupation = c(
"Wine and spirit merchant; house", "Baker", "Victualer"
),
addresses = c("1820 Mary hill", "", "280, High stret")
)
regex <- globals_regex_house_to_address
general_move_house_to_address(directory, regex)
directory <- tibble::tibble(
page = c("71", "71"),
surname = c("Abbott", "Abercromby"), forename = c("William", "Alexander"),
occupation = c("Wine and spirit merchant", "Baker"),
addresses = c(
"18, 20 London Street; ho. 136 Queen Street.",
"12 Dixon Street; res, 29 Anderston Quay."
)
)
regex <- globals_regex_house_split_trade
directory
general_split_trade_house_addresses(directory, regex, verbose = FALSE)
devtools::load_all(".")
devtools::load_all(".")
directory <- tibble::tibble(
page = c("71", "71"),
surname = c("Abbott", "Abercromby"), forename = c("William", "Alexander"),
occupation = c("Wine and spirit merchant", "Baker"),
addresses = c(
"18, 20 London Street; ho. 136 Queen Street.",
"12 Dixon Street; res, 29 Anderston Quay."
)
)
regex <- globals_regex_house_split_trade
general_split_trade_house_addresses(directory, regex, verbose = FALSE)
stringi::stri_escape_unicode("-")
stringi::stri_escape_unicode("–")
stringi::stri_escape_unicode("-")
tools::showNonASCIIfile(here::here("R", "globals.r"))
stringi::stri_escape_unicode("„")
tools::showNonASCIIfile(here::here("R", "globals.r"))
pacman::p_load(podcleaner, here, parallel, readr)
# Define globals ####
path_data <- "C:/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-entrepreneurs/analysis/extract-load-transform/data"
progress <- TRUE; verbose <- FALSE
# Load raw data ####
## Define locals ####
directories <- c("1861-1862")
## General directories ####
path_directories <- utils_make_path(path_data, "general-directories")
general_directory_raw <- utils_load_directories_csv(
"general", directories, path_directories, verbose
)
## trades directories ####
path_directories <- utils_make_path(path_data, "trades-directories")
trades_directory_raw <- utils_load_directories_csv(
"trades", directories, path_directories, verbose
)
# Clean ####
general_directory_clean <-
general_clean_directory(general_directory_raw, progress, verbose)
trades_directory_clean <-
trades_clean_directory(trades_directory_raw, progress, verbose)
trades_directory <- trades_directory_clean
general_directory <- general_directory_clean
nthread <- detectCores(all.tests = FALSE, logical = TRUE) - 1L
progress <- TRUE; verbose <- FALSE
combined <- combine_match_general_to_trades(
trades_directory, general_directory, progress, verbose,
method = "osa", max_dist = 5L, nthread = nthread
)
combined
path_output <- "C:/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-clean-pod/output"
file_name <- "post-office-directory-osa"
## rds ####
readr::write_rds(combined, paste0(path_output, "/", file_name, ".rds"))
## csv ####
readr::write_csv(combined, paste0(path_output, "/", file_name, ".csv"))
library(podcleaner)
devtools::load_all(".")
class(clean_address_body(c("18, 20 Londun st.", "136 Dixon rd")))
combine_random_string_if_pattern("random string", "random")
?combine_no_trade_address_to_random_string
dplyr::select(data.framce(a = "a", b = "b", c = "c"), a, b)
dplyr::select(data.frame(a = "a", b = "b", c = "c"), a, b)
dplyr::select(data.frame(a = "a", b = "b", c = "c"), a, b) %>% class()
x <- data.frame(a = "a", b = "b")
y <- tibble::tibble(a = "a", c = "c")
dplyr::left_join(x, y)
dplyr::left_join(x, y) %>% class()
devtools::load_all(".")
directory <- tibble::tibble(
page = rep("71", 3L),
surname = c("ABOT", "ABRCROMBIE", "BLAI"), forename = c("Wm.", "Alex", "Jn Huh"),
occupation = c(
"Wine and spirit merchant; house", "Baker", "Victualer"
)
directory
directory <- tibble::tibble(
page = rep("71", 3L),
surname = c("ABOT", "ABRCROMBIE", "BLAI"), forename = c("Wm.", "Alex", "Jn Huh"),
occupation = c(
"Wine and spirit merchant; house", "Baker", "Victualer"
),
addresses = c("1820 Mary hill", "", "280, High stret")
)
directory
general_move_house_to_address(directory, regex)
regex <- globals_regex_house_to_address
general_move_house_to_address(directory, regex)
directory <- tibble::tibble(
page = rep("71", 3L),
surname = c("ABOT", "ABRCROMBIE", "BLAI"), forename = c("Wm.", "Alex", "Jn Huh"),
occupation = c(
"Wine and spirit merchant; house, 1820", "Baker", "Victualer"
),
addresses = c(" Mary hill", "", "280, High stret")
)
directory
general_move_house_to_address(directory, regex)
?tibble::tibble
usethis::use_package("dplyr")
install.packages(c("backports", "broom", "cli", "conquer", "crayon", "dendextend", "downlit", "future", "generics", "ragg", "sessioninfo", "tzdb", "usethis", "uuid"))
install.packages(c("backports", "broom", "cli", "conquer", "crayon", "dendextend", "downlit", "future", "generics", "ragg", "sessioninfo", "tzdb", "usethis", "uuid"))
install.packages(c("backports", "broom", "cli", "conquer", "crayon", "dendextend", "downlit", "future", "generics", "ragg", "sessioninfo", "tzdb", "usethis", "uuid"))
sessionInfo()
pacman::p_load(dplyr, fuzzyjoin,
magrittr,
progress,
purrr,
readr,
rlang,
stringi,
stringr,
tibble,
tidyr)
sessionInfo()
install.packages(c("cli", "sessioninfo"))
install.packages(c("cli", "sessioninfo"))
install.packages(c("cli", "sessioninfo"))
sessionInfo()
pacman::p_load(dplyr, fuzzyjoin,
magrittr,
progress,
purrr,
readr,
rlang,
stringi,
stringr,
tibble,
tidyr)
sessionInfo()
# Checks ####
devtools::check_win_devel(email = "o.bautheac@gmail.com")
rhub::check(email = "o.bautheac@gmail.com")
# Permission issues on WSL. R_INSTALL_STAGED = FALSE required for running
# R CMD check in that context.
Sys.setenv(R_INSTALL_STAGED = FALSE)
devtools::release()
roxygen2::roxygenise(clean = TRUE)
devtools::spell_check()
devtools::spell_check()
devtools::release()
devtools::release()
library(podcleaner)
devtools::spell_check()
rhub::check(email = "o.bautheac@gmail.com")
rhub::check(email = "o.bautheac@gmail.com")
rhub::check(email = "o.bautheac@gmail.com")
devtools::check_win_devel(email = "olivier.bautheac@strath.ac.uk")
# Permission issues on WSL. R_INSTALL_STAGED = FALSE required for running
# R CMD check in that context.
Sys.setenv(R_INSTALL_STAGED = FALSE)
install.packages(c("dplyr", "readr", "rlang", "stringi", "tibble", "tidyr"))
install.packages(c("dplyr", "readr", "rlang", "stringi", "tibble", "tidyr"))
x <- 'Allan	Alexander - 72 Candleriggs.'
y <- 'Cowan	Alexander - 16 Candleriggs.'
stringdist::stringdist(x, y, 'osa')
stringdist::stringdist(x, y, 'cosine')
?stringdist
stringdist::stringdist(x, y, 'cosine', q = 5L)
x <- 'Allan	Alexander - 72 Candleriggs.'
y <- 'Cowan	Alexander - 16 Candleriggs.'
stringdist::stringdist(x, y, 'osa')
stringdist::stringdist(x, y, 'cosine', q = 5L)
rhub::check(email = "o.bautheac@gmail.com")
pacman::p_load(podcleaner, here, parallel, readr)
# Define globals ####
path_data <- "C:/Users/User/Dropbox/pro/Strathclyde/Fintech research assistant/glasgow-clean-pod/data"
progress <- TRUE; verbose <- FALSE
# Load raw data ####
## Define locals ####
directories <- c("1861-1862")
## General directories ####
path_directories <- utils_make_path(path_data, "general-directories")
general_directory_raw <- utils_load_directories_csv(
"general", directories, path_directories, verbose
)
## trades directories ####
path_directories <- utils_make_path(path_data, "trades-directories")
trades_directory_raw <- utils_load_directories_csv(
"trades", directories, path_directories, verbose
)
# Clean ####
general_directory_clean <-
general_clean_directory(general_directory_raw, progress, verbose)
trades_directory_clean <-
trades_clean_directory(trades_directory_raw, progress, verbose)
# Combine ####
## locals ####
trades_directory <- dplyr::slice(trades_directory_clean, 1:99L)
# trades_directory <- trades_directory_clean
general_directory <- general_directory_clean
nthread <- detectCores(all.tests = FALSE, logical = TRUE) - 1L
progress <- TRUE; verbose <- FALSE; distance <- TRUE;
combined <- combine_match_general_to_trades(
trades_directory, general_directory, progress, verbose, distance,
method = "osa", max_dist = 5L, nthread = nthread
)
combined
View(combined)
## locals ####
trades_directory <- dplyr::slice(trades_directory_clean, 1:199L)
## osa ####
combined <- combine_match_general_to_trades(
trades_directory, general_directory, progress, verbose, distance,
method = "osa", max_dist = 5L, nthread = nthread
)
View(combined)
## locals ####
trades_directory <- dplyr::slice(trades_directory_clean, 1:299L)
## osa ####
combined <- combine_match_general_to_trades(
trades_directory, general_directory, progress, verbose, distance,
method = "osa", max_dist = 5L, nthread = nthread
)
View(combined)
## locals ####
trades_directory <- dplyr::slice(trades_directory_clean, 1:500L)
## osa ####
combined <- combine_match_general_to_trades(
trades_directory, general_directory, progress, verbose, distance,
method = "osa", max_dist = 5L, nthread = nthread
)
View(combined)
library(podcleaner)
trades_directory <- tibble::tibble(
page = rep("71", 3L),
rank = c("135", "326", "586"),
surname = c("Abbott", "Abercromby", "Blair"),
forename = c("William", "Alexander", "John Hugh"),
occupation = c("Wine and spirit merchant", "Baker", "Victualler"),
type = rep("OWN ACCOUNT", 3L),
address.trade.number = c("18, 20", "12", "280"),
address.trade.body = c("London Road", "Dixon Place", "High Street")
)
general_directory <- tibble::tibble(
page = rep("71", 2L),
surname = c("Abbott", "Abercromby"), forename = c("William", "Alexander"),
occupation = c("Wine and spirit merchant", "Baker"),
address.trade.number = c("18, 20", ""),
address.house.number = c("136", "29"),
address.trade.body = c("London Road", "Dixon Place"),
address.house.body = c("Queen Square", "Anderston Quay")
)
out <- tibble::tibble(
page = rep("71", 3L),
rank = c("135", "326", "586"),
surname = c("Abbott", "Abercromby", "Blair"),
forename = c("William", "Alexander", "John Hugh"),
occupation = c("Wine and spirit merchant", "Baker", "Victualler"),
type = rep("OWN ACCOUNT", 3L),
address.trade.number = c("18, 20", "12", "280"),
address.trade.body = c("London Road", "Dixon Place", "High Street"),
address.house.number = c("136", "29", ""),
address.house.body = c(
"Queen Square", "Anderston Quay", "Failed to match with general directory"
)
)
combine_match_general_to_trades(
trades_directory, general_directory, progress = TRUE, verbose = FALSE,
method = "osa", max_dist = 5
)
test_that("general_clean_directory works in general", {
directory <- tibble::tibble(
page = rep("71", 2L),
surname = c("ABOT", "ABRCROMBIE"), forename = c("Wm.", "Alex"),
occupation = c("Wine and spirit mercht — See Advertisement in Appendix.", ""),
addresses = c(
"1S20 Londn rd; ho. 13<J Queun sq",
"Bkr; I2 Dixon Street, & 29 Auderstn Qu.; res 2G5 Argul st."
)
)
out <- tibble::tibble(
page = rep("71", 3L),
surname = c("Abbott", "Abercromby", "Abercromby"),
forename = c("William", "Alexander", "Alexander"),
occupation = c("Wine and spirit merchant", "Baker", "Baker"),
address.trade.number = c("18, 20", "12", "29"),
address.trade.body = c("London Road.", "Dixon Street.", "Anderston Quay."),
address.house.number = c("136", "265", "265"),
address.house.body = c("Queen Square.", "Argyle Street.", "Argyle Street.")
)
expect_equal(
general_clean_directory(directory, progress = TRUE, verbose = FALSE), out
)
})
rhub::check(email = "o.bautheac@gmail.com")
directory <- tibble::tibble(
page = rep("71", 2L),
surname = c("ABOT", "ABRCROMBIE"), forename = c("Wm.", "Alex"),
occupation = c("Wine and spirit mercht — See Advertisement in Appendix.", ""),
addresses = c(
"1820 Londn rd; ho. 13<J Queun sq",
"Bkr; I2 Dixon Street, & 29 Auderstn Qu.; res 2G5 Argul st."
)
)
general_clean_directory(directory, progress = TRUE, verbose = FALSE)
library(podcleaner)
general_clean_directory(directory, progress = TRUE, verbose = FALSE)
rhub::check(email = "o.bautheac@gmail.com")
library(podcleaner)
library(podcleaner)
rhub::check(email = "o.bautheac@gmail.com")
